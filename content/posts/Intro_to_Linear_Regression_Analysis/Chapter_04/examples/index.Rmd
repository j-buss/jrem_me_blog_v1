---
title: Model Adequacy Checking - Examples from Montgomery/Peck/Vining
author: Jeremy Buss
date: '2021-10-23'
slug: []
categories:
  - Introduction to Linear Regression Analysis - Montgomery/Peck/Vining
  - Applied Stats
  - Regression Analysis
tags:
  - R
  - linear regression
draft: true
katex: yes
---
```{r echo=FALSE}
library(blogdown)
```

For the example data we will leverage the CRAN package "MPV".

```{r message=FALSE}
#install.packages("MPV")
library(MPV)
```


# Example 4.1: The Delivery Time Data

Let's define the dataframe for the SoftDrink data and take a look at the first 5 rows:

```{r}
SoftDrink <- data.frame(MPV::softdrink)
colnames(SoftDrink) <- c("DeliveryTime", "NumberCases", "Distance")
head(SoftDrink, 5)
```

With the data ready we will create:

* **SoftDrink.lm**: multivariate linear model
* **SoftDrink.lm.sum**: the summary of the linear model 

```{r}
SoftDrink.lm <- lm(DeliveryTime ~ NumberCases + Distance, data=SoftDrink)
SoftDrink.lm.sum <- summary(SoftDrink.lm)
```

From the linear model we see that our linear model equation is: 

DeliveryTime = `r SoftDrink.lm$coefficients[1]` + `r SoftDrink.lm$coefficients[2]` x #ofCases + `r SoftDrink.lm$coefficients[3]` x Distance

Now that we have the linear model let's figure out some of the residuals:

## Residual ("vanilla")

The basic, run o' the mill residuals 

$$
e_i = y_i - \hat{y}_i
$$

These are available directly from the linear regression model:

```{r}
SoftDrink.lm.residuals <- SoftDrink.lm$residuals
head(SoftDrink.lm.residuals,5)
```

## Standardized Residuals

For the standardized Residuals we use the basic residuals and divide by the square root of Mean Square Residual

$$
d_i = \frac{e_i}{\sqrt{MS_{Res}}}
$$

Within R we can grab the sigma value from the summary of the linear model and leverage the residuals that we defined in the previous step:

```{r}
SoftDrink.lm.MS_res <- SoftDrink.lm.sum$sigma^2
SoftDrink.lm.StandardizedResiduals <- SoftDrink.lm.residuals / sqrt(SoftDrink.lm.MS_res)
head(SoftDrink.lm.StandardizedResiduals,5)
```

## Studentized Residuals 

For the **studentized residuals** we need to adjust the denominator of the residual to have constant variance regardless of location of $\mathbf{x_i}$.

This gives us:

$$
r_i = \frac{e_i}{\sqrt{MS_{res}(1-h_{ii})}}
$$
We would generally need to determine the values for $h_{ii}$ to calculate this residual. The $h_{ii}$ values can be determined with the following:

```{r}
SoftDrink.lm.HatValues <- lm.influence(SoftDrink.lm)$hat
head(SoftDrink.lm.HatValues,5)
```

However we are able to leverage a function to determined the studentized residuals straight away:

```{r}
SoftDrink.lm.StudentizedResiduals <- rstandard(SoftDrink.lm)
head(SoftDrink.lm.StudentizedResiduals,5)
```

## PRESS Residuals

The next flavor of residual is the **PRESS** residual which is the ordinary residual weighted by the diagonal elements of the hat matrix $h_{ii}$.

$$
e_{(i)}=y_i - \hat{y}_{(i)}
$$

```{r}
SoftDrink.lm.PRESSResiduals <- SoftDrink.lm.residuals / (1 - SoftDrink.lm.HatValues)
head(SoftDrink.lm.PRESSResiduals,5)
```

## R-Student Residuals

```{r}
PRESS(SoftDrink.lm, verbose=FALSE)$residuals
```

